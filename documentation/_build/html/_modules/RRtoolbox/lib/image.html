<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>RRtoolbox.lib.image &mdash; RRtoolbox 1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="RRtoolbox 1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for RRtoolbox.lib.image</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Bundle of methods for handling images. Rather than manipulating specialized</span>
<span class="sd">operations in images methods in this module are used for loading, outputting</span>
<span class="sd">and format-converting methods, as well as color manipulation.</span>

<span class="sd">SUPPORTED FORMATS</span>

<span class="sd">see http://docs.opencv.org/2.4/modules/highgui/doc/reading_and_writing_images_and_video.html#imread</span>

<span class="sd">+---------------------------+--------------------------------------------------+</span>
<span class="sd">| Format                    | Extension                                        |</span>
<span class="sd">+===========================+==================================================+</span>
<span class="sd">| Windows bitmaps           | \*.bmp, \*.dib (always supported)                |</span>
<span class="sd">+---------------------------+--------------------------------------------------+</span>
<span class="sd">| JPEG files                | \*.jpeg, \*.jpg, \*.jpe (see the Notes section)  |</span>
<span class="sd">+---------------------------+--------------------------------------------------+</span>
<span class="sd">| JPEG 2000 files           | \*.jp2 (see the Notes section)                   |</span>
<span class="sd">+---------------------------+--------------------------------------------------+</span>
<span class="sd">| Portable Network Graphics | \*.png (see the Notes section)                   |</span>
<span class="sd">+---------------------------+--------------------------------------------------+</span>
<span class="sd">| Portable image format     | \*.pbm, \*.pgm, \*.ppm (always supported)        |</span>
<span class="sd">+---------------------------+--------------------------------------------------+</span>
<span class="sd">| Sun rasters               | \*.sr, \*.ras (always supported)                 |</span>
<span class="sd">+---------------------------+--------------------------------------------------+</span>
<span class="sd">| TIFF files                | \*.tiff, \*.tif (see the Notes section)          |</span>
<span class="sd">+---------------------------+--------------------------------------------------+</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">zip</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">past.builtins</span> <span class="kn">import</span> <span class="nb">basestring</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">object</span>
<span class="kn">from</span> <span class="nn">.directory</span> <span class="kn">import</span> <span class="n">getData</span><span class="p">,</span> <span class="n">mkPath</span><span class="p">,</span> <span class="n">getPath</span><span class="p">,</span> <span class="n">increment_if_exits</span>
<span class="kn">from</span> <span class="nn">.config</span> <span class="kn">import</span> <span class="n">FLOAT</span><span class="p">,</span><span class="n">INT</span><span class="p">,</span><span class="n">MANAGER</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">.arrayops.basic</span> <span class="kn">import</span> <span class="n">anorm</span><span class="p">,</span> <span class="n">polygonArea</span><span class="p">,</span> <span class="n">im2shapeFormat</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">vectorsAngles</span><span class="p">,</span> <span class="n">overlay</span><span class="p">,</span> \
    <span class="n">standarizePoints</span><span class="p">,</span> <span class="n">splitPoints</span>
<span class="kn">from</span> <span class="nn">.root</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="c1">#from pyqtgraph import QtGui #BUG in pydev ImportError: cannot import name QtOpenGL</span>
<span class="kn">from</span> <span class="nn">.cache</span> <span class="kn">import</span> <span class="n">Cache</span><span class="p">,</span> <span class="n">ResourceManager</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">.directory</span> <span class="kn">import</span> <span class="n">getData</span><span class="p">,</span> <span class="n">strdifference</span><span class="p">,</span> <span class="n">changedir</span><span class="p">,</span> <span class="n">checkFile</span><span class="p">,</span> <span class="n">getFileHandle</span><span class="p">,</span> \
    <span class="n">increment_if_exits</span><span class="p">,</span> <span class="n">mkPath</span>
<span class="kn">import</span> <span class="nn">matplotlib.axes</span>
<span class="kn">import</span> <span class="nn">matplotlib.figure</span>
<span class="kn">from</span> <span class="nn">.plotter</span> <span class="kn">import</span> <span class="n">Plotim</span><span class="p">,</span> <span class="n">limitaxis</span>
<span class="kn">from</span> <span class="nn">.serverServices</span> <span class="kn">import</span> <span class="n">parseString</span><span class="p">,</span> <span class="n">string_is_socket_address</span>


<span class="n">supported_formats</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;bmp&quot;</span><span class="p">,</span><span class="s2">&quot;dib&quot;</span><span class="p">,</span><span class="s2">&quot;jpeg&quot;</span><span class="p">,</span><span class="s2">&quot;jpg&quot;</span><span class="p">,</span><span class="s2">&quot;jpe&quot;</span><span class="p">,</span><span class="s2">&quot;jp2&quot;</span><span class="p">,</span><span class="s2">&quot;png&quot;</span><span class="p">,</span><span class="s2">&quot;pbm&quot;</span><span class="p">,</span><span class="s2">&quot;pgm&quot;</span><span class="p">,</span><span class="s2">&quot;ppm&quot;</span><span class="p">,</span><span class="s2">&quot;sr&quot;</span><span class="p">,</span><span class="s2">&quot;ras&quot;</span><span class="p">,</span><span class="s2">&quot;tiff&quot;</span><span class="p">,</span><span class="s2">&quot;tif&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="transposeIm"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.transposeIm">[docs]</a><span class="k">def</span> <span class="nf">transposeIm</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">im</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">im</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>

<span class="c1">#from matplotlib import colors</span>

<span class="c1"># colors to use</span>
<span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">red</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">white</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">orange</span> <span class="o">=</span> <span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">236</span><span class="p">)</span>
<span class="n">black</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">blue</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># dictionary of colors to use</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">&quot;blue&quot;</span><span class="p">:</span><span class="n">blue</span><span class="p">,</span>
<span class="s2">&quot;green&quot;</span><span class="p">:</span><span class="n">green</span><span class="p">,</span>
<span class="s2">&quot;red&quot;</span><span class="p">:</span><span class="n">red</span><span class="p">,</span>
<span class="s2">&quot;white&quot;</span><span class="p">:</span><span class="n">white</span><span class="p">,</span>
<span class="s2">&quot;orange&quot;</span><span class="p">:</span><span class="n">orange</span><span class="p">,</span>
<span class="s2">&quot;black&quot;</span><span class="p">:</span><span class="n">black</span><span class="p">}</span>

<span class="c1"># look for these as &lt;numpy array&gt;.dtype.names</span>
<span class="n">bgra_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="mi">3</span><span class="p">)})</span>

<div class="viewcode-block" id="plt2bgr"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.plt2bgr">[docs]</a><span class="k">def</span> <span class="nf">plt2bgr</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">SubplotBase</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">fig2bgr</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">fig2bgr</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="plt2bgra"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.plt2bgra">[docs]</a><span class="k">def</span> <span class="nf">plt2bgra</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">SubplotBase</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">fig2bgra</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">fig2bgra</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="fig2bgr"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.fig2bgr">[docs]</a><span class="k">def</span> <span class="nf">fig2bgr</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a Matplotlib figure to a RGB image.</span>

<span class="sd">    :param fig: a matplotlib figure</span>
<span class="sd">    :return: RGB image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tostring_rgb</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># get bgr</span>
    <span class="k">return</span> <span class="n">buf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_width_height</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span></div>

<div class="viewcode-block" id="np2str"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.np2str">[docs]</a><span class="k">def</span> <span class="nf">np2str</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">tostring</span><span class="p">()</span></div>

<div class="viewcode-block" id="str2np"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.str2np">[docs]</a><span class="k">def</span> <span class="nf">str2np</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="n">shape</span><span class="p">):</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># get bgr</span>
    <span class="k">return</span> <span class="n">buf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="fig2bgra"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.fig2bgra">[docs]</a><span class="k">def</span> <span class="nf">fig2bgra</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a Matplotlib figure to a RGBA image.</span>

<span class="sd">    :param fig: a matplotlib figure</span>
<span class="sd">    :return: RGBA image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#http://www.icare.univ-lille1.fr/drupal/node/1141</span>
    <span class="c1">#http://stackoverflow.com/questions/7821518/matplotlib-save-plot-to-numpy-array</span>
    <span class="c1"># draw the renderer</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="c1"># Get the RGBA buffer from the figure</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tostring_argb</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="p">)</span> <span class="c1"># get bgra</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_width_height</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="p">,))</span> <span class="c1"># reshape to h,w,c</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># correct channels</span></div>

<div class="viewcode-block" id="qi2np"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.qi2np">[docs]</a><span class="k">def</span> <span class="nf">qi2np</span><span class="p">(</span><span class="n">qimage</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert QImage to numpy.ndarray.  The dtype defaults to uint8</span>
<span class="sd">    for QImage.Format_Indexed8 or `bgra_dtype` (i.e. a record array)</span>
<span class="sd">    for 32bit color images.  You can pass a different dtype to use, or</span>
<span class="sd">    &#39;array&#39; to get a 3D uint8 array for color images.</span>

<span class="sd">    source from: https://kogs-www.informatik.uni-hamburg.de/~meine/software/vigraqt/qimage2ndarray.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyqtgraph</span> <span class="kn">import</span> <span class="n">QtGui</span>
    <span class="k">if</span> <span class="n">qimage</span><span class="o">.</span><span class="n">isNull</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Image is Null&quot;</span><span class="p">)</span>
    <span class="n">result_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">qimage</span><span class="o">.</span><span class="n">height</span><span class="p">(),</span> <span class="n">qimage</span><span class="o">.</span><span class="n">width</span><span class="p">())</span>
    <span class="n">temp_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">qimage</span><span class="o">.</span><span class="n">height</span><span class="p">(),</span> <span class="n">qimage</span><span class="o">.</span><span class="n">bytesPerLine</span><span class="p">()</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="n">qimage</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">qimage</span><span class="o">.</span><span class="n">format</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="o">.</span><span class="n">Format_ARGB32_Premultiplied</span><span class="p">,</span>
                            <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="o">.</span><span class="n">Format_ARGB32</span><span class="p">,</span>
                            <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="o">.</span><span class="n">Format_RGB32</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;rec&#39;</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">bgra_dtype</span>
        <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
            <span class="n">result_shape</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">temp_shape</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">elif</span> <span class="n">qimage</span><span class="o">.</span><span class="n">format</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="o">.</span><span class="n">Format_Indexed8</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;qi2np only supports 32bit and 8bit images&quot;</span><span class="p">)</span>
    <span class="c1"># FIXME: raise error if alignment does not match</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">qimage</span><span class="o">.</span><span class="n">bits</span><span class="p">()</span><span class="o">.</span><span class="n">asstring</span><span class="p">(</span><span class="n">qimage</span><span class="o">.</span><span class="n">numBytes</span><span class="p">())</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">result_shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result_shape</span> <span class="o">!=</span> <span class="n">temp_shape</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:,:</span><span class="n">result_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">qimage</span><span class="o">.</span><span class="n">format</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="o">.</span><span class="n">Format_RGB32</span> <span class="ow">and</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="o">...</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="np2qi"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.np2qi">[docs]</a><span class="k">def</span> <span class="nf">np2qi</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert numpy array to Qt Image.</span>

<span class="sd">    source from: https://kogs-www.informatik.uni-hamburg.de/~meine/software/vigraqt/qimage2ndarray.py</span>

<span class="sd">    :param array:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gray2qi</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rgb2qi</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;can only convert 2D or 3D arrays&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="gray2qi"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.gray2qi">[docs]</a><span class="k">def</span> <span class="nf">gray2qi</span><span class="p">(</span><span class="n">gray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the 2D numpy array `gray` into a 8-bit QImage with a gray</span>
<span class="sd">    colormap.  The first dimension represents the vertical image axis.</span>

<span class="sd">    ATTENTION: This QImage carries an attribute `ndimage` with a</span>
<span class="sd">    reference to the underlying numpy array that holds the data. On</span>
<span class="sd">    Windows, the conversion into a QPixmap does not copy the data, so</span>
<span class="sd">    that you have to take care that the QImage does not get garbage</span>
<span class="sd">    collected (otherwise PyQt will throw away the wrapper, effectively</span>
<span class="sd">    freeing the underlying memory - boom!).</span>

<span class="sd">    source from: https://kogs-www.informatik.uni-hamburg.de/~meine/software/vigraqt/qimage2ndarray.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyqtgraph</span> <span class="kn">import</span> <span class="n">QtGui</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;gray2QImage can only convert 2D arrays&quot;</span><span class="p">)</span>

    <span class="n">gray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">)</span>

    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">gray</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="p">(</span><span class="n">gray</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="o">.</span><span class="n">Format_Indexed8</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">gray</span> <span class="c1"># let object live to avoid garbage collection</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    for i in xrange(256):</span>
<span class="sd">        result.setColor(i, QtGui.QColor(i, i, i).rgb())&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="rgb2qi"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.rgb2qi">[docs]</a><span class="k">def</span> <span class="nf">rgb2qi</span><span class="p">(</span><span class="n">rgb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the 3D numpy array `rgb` into a 32-bit QImage.  `rgb` must</span>
<span class="sd">    have three dimensions with the vertical, horizontal and RGB image axes.</span>

<span class="sd">    ATTENTION: This QImage carries an attribute `ndimage` with a</span>
<span class="sd">    reference to the underlying numpy array that holds the data. On</span>
<span class="sd">    Windows, the conversion into a QPixmap does not copy the data, so</span>
<span class="sd">    that you have to take care that the QImage does not get garbage</span>
<span class="sd">    collected (otherwise PyQt will throw away the wrapper, effectively</span>
<span class="sd">    freeing the underlying memory - boom!).</span>

<span class="sd">    source from: https://kogs-www.informatik.uni-hamburg.de/~meine/software/vigraqt/qimage2ndarray.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyqtgraph</span> <span class="kn">import</span> <span class="n">QtGui</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgb</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;rgb2QImage can only convert 3D arrays&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rgb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;rgb2QImage can expects the last dimension to contain &quot;</span>
                         <span class="s2">&quot;exactly three (R,G,B) or four (R,G,B,A) channels&quot;</span><span class="p">)</span>

    <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">rgb</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1"># Qt expects 32bit BGRA data for color images:</span>
    <span class="n">bgra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">)</span>
    <span class="n">bgra</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">bgra</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">bgra</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># dstack, dsplit, stack</span>
    <span class="k">if</span> <span class="n">rgb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">bgra</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="o">.</span><span class="n">Format_RGB32</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bgra</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="o">.</span><span class="n">Format_ARGB32</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="p">(</span><span class="n">bgra</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">bgra</span>  <span class="c1"># let object live to avoid garbage collection</span>
    <span class="k">return</span> <span class="n">result</span></div>

<span class="c1"># STABLE FUNCTIONS</span>
<div class="viewcode-block" id="bgra2bgr"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.bgra2bgr">[docs]</a><span class="k">def</span> <span class="nf">bgra2bgr</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">bgrcolor</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="s2">&quot;white&quot;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert BGR to BGRA image.</span>

<span class="sd">    :param im: image</span>
<span class="sd">    :param bgrcolor: BGR color representing transparency. (information is lost when</span>
<span class="sd">                    converting BGRA to BGR) e.g. [200,200,200].</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># back[chanel] = bgr[chanel]*(bgr[3]/255.0) + back[chanel]*(1-bgr[3]/255.0)</span>
    <span class="n">temp</span><span class="o">=</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">im2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">im2</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="n">bgrcolor</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span> <span class="c1">#looping over channels</span>
        <span class="n">im2</span><span class="p">[:,:,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">im</span><span class="p">[:,:,</span><span class="n">c</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">im</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mf">255.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">im2</span><span class="p">[:,:,</span><span class="n">c</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">im</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mf">255.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">im2</span></div>

<div class="viewcode-block" id="convertAs"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.convertAs">[docs]</a><span class="k">def</span> <span class="nf">convertAs</span><span class="p">(</span><span class="n">fns</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
              <span class="n">overwrite</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">loader</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">simulate</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a file and save as other file based in a pattern.</span>

<span class="sd">    :param fns: file name or list of file names. It supports glob operations.</span>
<span class="sd">            By default glob operations ignore folders.</span>
<span class="sd">    :param base: path to place images.</span>
<span class="sd">    :param folder: (None) folder to place images in base&#39;s path.</span>
<span class="sd">            If True it uses the folder in which image was loaded.</span>
<span class="sd">            If None, not folder is used.</span>
<span class="sd">    :param name: string for formatting new name of image with the {name} tag.</span>
<span class="sd">            Ex: if name is &#39;new_{name}&#39; and image is called &#39;img001&#39; then the</span>
<span class="sd">            formatted new image&#39;s name is &#39;new_img001&#39;</span>
<span class="sd">    :param ext: (None) extension to save all images. If None uses the same extension</span>
<span class="sd">            as the loaded image.</span>
<span class="sd">    :param overwrite: (False) If True and the destine filename for saving already</span>
<span class="sd">            exists then it is replaced, else a new filename is generated</span>
<span class="sd">            with an index &quot;{name}_{index}.{extension}&quot;</span>
<span class="sd">    :param loader: (None) loader for the image file to change image attributes.</span>
<span class="sd">            If None reads the original images untouched.</span>
<span class="sd">    :param simulate: (False) if True, no saving is performed but the status is returned</span>
<span class="sd">            to confirm what images where adequately processed.</span>
<span class="sd">    :return: list of statuses (0 - no error, 1 - image not loaded,</span>
<span class="sd">            2 - image not saved, 3 - error in processing image)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">loader</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">loadFunc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fns</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">fns</span><span class="p">)</span> <span class="c1"># list</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># is an iterator</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fns</span><span class="p">:</span>
            <span class="n">filelist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">base</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">base</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="c1"># ensures that path from base ends with separator</span>
    <span class="k">if</span> <span class="n">base</span><span class="p">:</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">replaceparts</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="c1"># from base get parts</span>
    <span class="c1"># ensures that extension starts with point &quot;.&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span><span class="nb">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">ext</span> <span class="c1"># correct extension</span>

    <span class="n">status</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="c1"># file parts</span>
        <span class="c1"># replace drive</span>
        <span class="k">if</span> <span class="n">replaceparts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">replaceparts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># replace root</span>
        <span class="k">if</span> <span class="n">replaceparts</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">folder</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">replaceparts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="nb">basestring</span><span class="p">):</span>
                <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">replaceparts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">replaceparts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># to replace basic name</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">basestring</span><span class="p">):</span>
            <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span><span class="nb">basestring</span><span class="p">):</span>
            <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">ext</span> <span class="c1"># replace extension</span>
        <span class="n">newfile</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">newfile</span> <span class="o">=</span> <span class="n">increment_if_exits</span><span class="p">(</span><span class="n">newfile</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">loader</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>

            <span class="c1"># image not loaded</span>
            <span class="k">if</span> <span class="n">im</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">status</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">file</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">newfile</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="c1"># image successfully saved</span>
            <span class="k">if</span> <span class="n">simulate</span><span class="p">:</span>
                <span class="n">status</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">file</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">newfile</span><span class="p">))</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mkPath</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">newfile</span><span class="p">,</span><span class="n">im</span><span class="p">):</span>
                    <span class="n">status</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">file</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">newfile</span><span class="p">))</span>
                    <span class="k">continue</span>

            <span class="c1"># image not saved</span>
            <span class="n">status</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">file</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">newfile</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># an error in the process</span>
            <span class="n">status</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">file</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">newfile</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="checkLoaded"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.checkLoaded">[docs]</a><span class="k">def</span> <span class="nf">checkLoaded</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">raiseError</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple function to determine if variable is valid.</span>

<span class="sd">    :param obj: loaded object</span>
<span class="sd">    :param fn: path of file</span>
<span class="sd">    :param raiseError: if True and obj is None, raise</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot; Loaded...&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot; Could not be loaded...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">raiseError</span><span class="p">:</span> <span class="k">raise</span></div>

<div class="viewcode-block" id="loadcv"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.loadcv">[docs]</a><span class="k">def</span> <span class="nf">loadcv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">flags</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple function to load using opencv.</span>

<span class="sd">    :param path: path to image.</span>
<span class="sd">    :param flag: openCV flags:</span>

<span class="sd">                +-------+------------------------------+--------+</span>
<span class="sd">                | value | openCV flag                  | output |</span>
<span class="sd">                +=======+==============================+========+</span>
<span class="sd">                | (1)   | cv2.CV_LOAD_IMAGE_COLOR      | BGR    |</span>
<span class="sd">                +-------+------------------------------+--------+</span>
<span class="sd">                | (0)   | cv2.CV_LOAD_IMAGE_GRAYSCALE  | GRAY   |</span>
<span class="sd">                +-------+------------------------------+--------+</span>
<span class="sd">                | (-1)  | cv2.CV_LOAD_IMAGE_UNCHANGED  | format |</span>
<span class="sd">                +-------+------------------------------+--------+</span>
<span class="sd">    :param shape: shape to resize image.</span>
<span class="sd">    :return: loaded image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">shape</span><span class="p">:</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">im</span></div>

<div class="viewcode-block" id="loadsfrom"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.loadsfrom">[docs]</a><span class="k">def</span> <span class="nf">loadsfrom</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_COLOR</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads Image from URL or file.</span>

<span class="sd">    :param path: filepath or url</span>
<span class="sd">    :param flags: openCV flags:</span>

<span class="sd">                +-------+------------------------------+--------+</span>
<span class="sd">                | value | openCV flag                  | output |</span>
<span class="sd">                +=======+==============================+========+</span>
<span class="sd">                | (1)   | cv2.CV_LOAD_IMAGE_COLOR      | BGR    |</span>
<span class="sd">                +-------+------------------------------+--------+</span>
<span class="sd">                | (0)   | cv2.CV_LOAD_IMAGE_GRAYSCALE  | GRAY   |</span>
<span class="sd">                +-------+------------------------------+--------+</span>
<span class="sd">                | (-1)  | cv2.CV_LOAD_IMAGE_UNCHANGED  | format |</span>
<span class="sd">                +-------+------------------------------+--------+</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="nb">basestring</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.npy&quot;</span><span class="p">):</span><span class="c1"># reads numpy arrays</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">getFileHandle</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="c1"># download the image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">path</span> <span class="c1"># assume path is a file-like object ie. cStringIO or file</span>
    <span class="c1">#nparr = np.asarray(bytearray(resp.read()), dtype=dtype) # convert it to a NumPy array</span>
    <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imdecode</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span> <span class="c1"># decode using OpenCV format</span>
    <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="interpretImage"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.interpretImage">[docs]</a><span class="k">def</span> <span class="nf">interpretImage</span><span class="p">(</span><span class="n">toparse</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interprets to get image.</span>

<span class="sd">    :param toparse: string to parse or array. It can interpret:</span>

<span class="sd">        * connection to server (i.e. host:port)</span>
<span class="sd">        * path to file (e.g. /path_to_image/image_name.ext)</span>
<span class="sd">        * URL to image (e.g. http://domain.com/path_to_image/image_name.ext)</span>
<span class="sd">        * image as string (i.g. numpy converted to string)</span>
<span class="sd">        * image itself (i.e. numpy array)</span>

<span class="sd">    :param flags: openCV flags:</span>

<span class="sd">                +-------+------------------------------+--------+</span>
<span class="sd">                | value | openCV flag                  | output |</span>
<span class="sd">                +=======+==============================+========+</span>
<span class="sd">                | (1)   | cv2.CV_LOAD_IMAGE_COLOR      | BGR    |</span>
<span class="sd">                +-------+------------------------------+--------+</span>
<span class="sd">                | (0)   | cv2.CV_LOAD_IMAGE_GRAYSCALE  | GRAY   |</span>
<span class="sd">                +-------+------------------------------+--------+</span>
<span class="sd">                | (-1)  | cv2.CV_LOAD_IMAGE_UNCHANGED  | format |</span>
<span class="sd">                +-------+------------------------------+--------+</span>

<span class="sd">    :return: image or None if not successfull</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># test it is from server</span>
    <span class="k">if</span> <span class="n">string_is_socket_address</span><span class="p">(</span><span class="n">toparse</span><span class="p">):</span> <span class="c1">#process request to server</span>
        <span class="n">toparse</span> <span class="o">=</span> <span class="n">parseString</span><span class="p">(</span><span class="n">toparse</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="c1"># test is object itself</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">toparse</span><span class="p">)</span><span class="o">.</span><span class="n">__module__</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">__name__</span><span class="p">:</span> <span class="c1"># test numpy array</span>
        <span class="k">if</span> <span class="n">flags</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">im2shapeFormat</span><span class="p">(</span><span class="n">toparse</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">flags</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">im2shapeFormat</span><span class="p">(</span><span class="n">toparse</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">toparse</span>
    <span class="c1"># test image in string</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imdecode</span><span class="p">(</span><span class="n">toparse</span><span class="p">,</span><span class="n">flags</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="c1"># test path to file or URL</span>
        <span class="k">return</span> <span class="n">loadsfrom</span><span class="p">(</span><span class="n">toparse</span><span class="p">,</span><span class="n">flags</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImFactory"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImFactory">[docs]</a><span class="k">class</span> <span class="nc">ImFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    image factory for RRToolbox to create scripts to standardize loading images and</span>
<span class="sd">    provide lazy loading (it can load images from disk with the customized options</span>
<span class="sd">    and/or create mapping images to load when needed) to conserve memory.</span>

<span class="sd">    .. warning:: In development.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_interpolations</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nearest&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;bilinear&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;bicubic&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;lanczos&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>
    <span class="n">_convertions</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">        :return:</span>

<span class="sd">        An image can be represented as a matrix of width &quot;W&quot; and height &quot;H&quot; with elements</span>
<span class="sd">        called pixels,each pixel is a representation of a color in one point of a plane</span>
<span class="sd">        (2D dimension). In the case of openCV and many other libraries for image manipulation,</span>
<span class="sd">        the use of numpy arrays as base for image representation is becoming the standard</span>
<span class="sd">        (numpy is a fast and powerful library for array manipulation and one of the main modules</span>
<span class="sd">        for scientific development in python). A numpy matrix with n rows and m columns has a</span>
<span class="sd">        shape (n,m), that in an Image is H,W which in a Cartesian plane would be y,x.</span>

<span class="sd">        if image is W,H = 100,100 then</span>
<span class="sd">        dsize = (W,H) = (300,100) would be the same as fsize = (fx,fy) = (3,1)</span>
<span class="sd">        after the image is loaded in a numpy array the image would have shape</span>
<span class="sd">        (n,m) = (rows,cols) = (H,W) = im.shape</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1"># path to use to load image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mmap_mode</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1"># mapping file modes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mmap_path</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1"># path to create numpy file; None, do not create mapping file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throw</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1">#TODO not finished</span>

<div class="viewcode-block" id="ImFactory.update"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImFactory.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not attribute &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span></div>

<div class="viewcode-block" id="ImFactory.get_Func"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImFactory.get_Func">[docs]</a>    <span class="k">def</span> <span class="nf">get_Func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets the loading function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="ImFactory.get_code"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImFactory.get_code">[docs]</a>    <span class="k">def</span> <span class="nf">get_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the script code</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="ImFactory.get_errorFunc"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImFactory.get_errorFunc">[docs]</a>    <span class="k">def</span> <span class="nf">get_errorFunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">throw</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">errorFunc</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">throw</span> <span class="ow">and</span> <span class="n">im</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">checkFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">getData</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">supported_formats</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not enough permissions to load &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to load &#39;{}&#39;. Format not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Missing file &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">None</span><span class="p">:</span><span class="n">errorFunc</span><span class="p">}</span></div>

<div class="viewcode-block" id="ImFactory.get_loadFunc"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImFactory.get_loadFunc">[docs]</a>    <span class="k">def</span> <span class="nf">get_loadFunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">loadFunc</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;im&quot;</span><span class="p">:</span><span class="n">loadFunc</span><span class="p">}</span></div>

<div class="viewcode-block" id="ImFactory.get_resizeFunc"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImFactory.get_resizeFunc">[docs]</a>    <span class="k">def</span> <span class="nf">get_resizeFunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsize</span><span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># see http://docs.opencv.org/2.4/modules/imgproc/doc/geometric_transformations.html#resize</span>
        <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span> <span class="n">fx</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fy</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">interpolation</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="k">def</span> <span class="nf">resizeFunc</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">dsize</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;im&quot;</span><span class="p">:</span><span class="n">resizeFunc</span><span class="p">}</span></div>

<div class="viewcode-block" id="ImFactory.get_mapFunc"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImFactory.get_mapFunc">[docs]</a>    <span class="k">def</span> <span class="nf">get_mapFunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">RGB</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">mpath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">dsize</span><span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">mapFunc</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mpath</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span> <span class="c1"># save mmap in working directory</span>
                <span class="n">drive</span><span class="p">,</span><span class="n">dirname</span><span class="p">,(</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">getData</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">elif</span> <span class="n">mpath</span><span class="p">:</span><span class="c1"># save mmap in mpath</span>
                <span class="n">drive</span><span class="p">,</span><span class="n">dirname</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span><span class="n">changedir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">mpath</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># save mmap in image path</span>
                <span class="n">drive</span><span class="p">,</span><span class="n">dirname</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="c1"># THIS CREATES ONE HASHED FILE</span>
            <span class="n">hashed</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s2">&quot;{}{}{}{}{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span><span class="n">RGB</span><span class="p">,</span><span class="n">dsize</span><span class="p">,</span><span class="n">fx</span><span class="p">,</span><span class="n">fy</span><span class="p">,</span><span class="n">interpolation</span><span class="p">))</span>
            <span class="n">savepath</span> <span class="o">=</span> <span class="s2">&quot;{}{}{}{}.{}.npy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span><span class="n">dirname</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span><span class="p">,</span><span class="n">hashed</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span> <span class="c1"># load from map</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">mode</span><span class="p">)</span> <span class="c1"># mapper(savepath,None,mode,True)[0]#</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span> <span class="c1"># create object and map</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">im</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c1"># this is regardless of throw flag</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to load image to map&quot;</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">im</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">mode</span><span class="p">)</span> <span class="c1"># mapper(savepath,im,mode,True)[0]#</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;im&quot;</span><span class="p">:</span><span class="n">mapFunc</span><span class="p">}</span></div>

<div class="viewcode-block" id="ImFactory.get_transposeFunc"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImFactory.get_transposeFunc">[docs]</a>    <span class="k">def</span> <span class="nf">get_transposeFunc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">transposeFunc</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">im</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">im</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># np.ascontiguousarray? http://stackoverflow.com/a/27601130/5288758</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;im&quot;</span><span class="p">:</span><span class="n">transposeFunc</span><span class="p">}</span></div>

<div class="viewcode-block" id="ImFactory.get_convertionFunc"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImFactory.get_convertionFunc">[docs]</a>    <span class="k">def</span> <span class="nf">get_convertionFunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">convertionFunc</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">code</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;im&quot;</span><span class="p">:</span><span class="n">convertionFunc</span><span class="p">}</span></div>

<div class="viewcode-block" id="ImFactory.get_np2qi"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImFactory.get_np2qi">[docs]</a>    <span class="k">def</span> <span class="nf">get_np2qi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;im&quot;</span><span class="p">:</span><span class="n">np2qi</span><span class="p">}</span></div></div>

<div class="viewcode-block" id="loadFunc"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.loadFunc">[docs]</a><span class="k">def</span> <span class="nf">loadFunc</span><span class="p">(</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dsize</span><span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">mmode</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">mpath</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">throw</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">keepratio</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a function that loads image array from path, url,</span>
<span class="sd">    server, string or directly from numpy array (supports databases).</span>

<span class="sd">    :param flag: (default: 0) 0 to read as gray, 1 to read as BGR, -1 to</span>
<span class="sd">                read as BGRA, 2 to read as RGB, -2 to read as RGBA.</span>

<span class="sd">                It supports openCV flags:</span>
<span class="sd">                    * cv2.CV_LOAD_IMAGE_COLOR</span>
<span class="sd">                    * cv2.CV_LOAD_IMAGE_GRAYSCALE</span>
<span class="sd">                    * cv2.CV_LOAD_IMAGE_UNCHANGED</span>

<span class="sd">                +-------+-------------------------------+--------+</span>
<span class="sd">                | value | openCV flag                   | output |</span>
<span class="sd">                +=======+===============================+========+</span>
<span class="sd">                | (2)   | N/A                           | RGB    |</span>
<span class="sd">                +-------+-------------------------------+--------+</span>
<span class="sd">                | (1)   | cv2.CV_LOAD_IMAGE_COLOR       | BGR    |</span>
<span class="sd">                +-------+-------------------------------+--------+</span>
<span class="sd">                | (0)   | cv2.CV_LOAD_IMAGE_GRAYSCALE   | GRAY   |</span>
<span class="sd">                +-------+-------------------------------+--------+</span>
<span class="sd">                | (-1)  | cv2.CV_LOAD_IMAGE_UNCHANGED   | BGRA   |</span>
<span class="sd">                +-------+-------------------------------+--------+</span>
<span class="sd">                | (-2)  | N/A                           | RGBA   |</span>
<span class="sd">                +-------+-------------------------------+--------+</span>

<span class="sd">    :param dsize: (None) output image size; if it equals zero, it is computed as:</span>

<span class="sd">                \texttt{dsize = Size(round(fx*src.cols), round(fy*src.rows))}</span>

<span class="sd">                If (integer,None) or (None,integer) it completes the values according</span>
<span class="sd">                to keepratio parameter.</span>

<span class="sd">    :param dst: (None) output image; it has the size dsize (when it is non-zero) or the</span>
<span class="sd">                size computed from src.size(), fx, and fy; the type of dst is uint8.</span>
<span class="sd">    :param fx: scale factor along the horizontal axis</span>
<span class="sd">    :param fy: scale factor along the vertical axis</span>
<span class="sd">    :param interpolation: interpolation method compliant with opencv:</span>

<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>
<span class="sd">                |flag | Operation       | Description                                           |</span>
<span class="sd">                +=====+=================+=======================================================+</span>
<span class="sd">                |(0)  | INTER_NEAREST   | nearest-neighbor interpolation                        |</span>
<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>
<span class="sd">                |(1)  | INTER_LINEAR    | bilinear interpolation (used by default)              |</span>
<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>
<span class="sd">                |(2)  | INTER_CUBIC     | bicubic interpolation over 4x4 pixel neighborhood     |</span>
<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>
<span class="sd">                |(3)  | INTER_AREA      | resampling using pixel area relation.                 |</span>
<span class="sd">                |     |                 | It may be a preferred method for image decimation,    |</span>
<span class="sd">                |     |                 | as it gives moire’-free results. But when the image   |</span>
<span class="sd">                |     |                 | is zoomed, it is similar to the INTER_NEAREST method. |</span>
<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>
<span class="sd">                |(4)  | INTER_LANCZOS4  | Lanczos interpolation over 8x8 pixel neighborhood     |</span>
<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>

<span class="sd">    :param mmode: (None) mmode to create mapped file. if mpath is specified loads image, converts</span>
<span class="sd">                to mapped file and then loads mapping file with mode {None, &#39;r+&#39;, &#39;r&#39;, &#39;w+&#39;, &#39;c&#39;}</span>
<span class="sd">                (it is slow for big images). If None, loads mapping file to memory (useful to keep</span>
<span class="sd">                image copy for session even if original image is deleted or modified).</span>
<span class="sd">    :param mpath: (None) path to create mapped file.</span>
<span class="sd">                None, do not create mapping file</span>
<span class="sd">                &quot;&quot;, uses path directory;</span>
<span class="sd">                &quot;*&quot;, uses working directory;</span>
<span class="sd">                else, uses specified directory.</span>
<span class="sd">    :param keepratio: True to keep image ratio when completing data from dsize,fx and fy,</span>
<span class="sd">                False to not keep ratio.</span>

<span class="sd">    .. note::</span>

<span class="sd">        If mmode is None and mpath is given it creates mmap file but loads from it to memory.</span>
<span class="sd">        It is useful to create physical copy of data to keep loading from (data can be reloaded</span>
<span class="sd">        even if original file is moved or deleted).</span>

<span class="sd">    :return loader function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create factory functions</span>
    <span class="k">def</span> <span class="nf">errorFunc</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">im</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">checkFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">getData</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="n">supported_formats</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not enough permissions to load &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to load &#39;{}&#39;. Format not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Missing file &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="n">RGB</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="c1"># determine if needs to do conversion from BGR to RGB</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span><span class="o">//</span><span class="mi">2</span> <span class="c1"># get normal flag</span>
        <span class="n">RGB</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">loadfunc</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">interpretImage</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span> <span class="c1"># load func</span>
        <span class="k">if</span> <span class="n">throw</span><span class="p">:</span> <span class="n">errorFunc</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">path</span><span class="p">)</span> <span class="c1"># if not loaded throw error</span>
        <span class="k">if</span> <span class="n">flag</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">RGB</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGBA</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2BGRA</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">RGB</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">flag</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGRA2RGBA</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">im</span>

    <span class="k">if</span> <span class="n">dsize</span> <span class="ow">or</span> <span class="n">dst</span> <span class="ow">or</span> <span class="n">fx</span> <span class="ow">or</span> <span class="n">fy</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fx</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">fy</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fx</span><span class="o">=</span><span class="n">fy</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">keepratio</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">fy</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">fy</span> <span class="o">=</span> <span class="n">fx</span>
            <span class="k">elif</span> <span class="n">fy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">fx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">fx</span> <span class="o">=</span> <span class="n">fy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">fy</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">fy</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">fy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">fx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">fx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">interpolation</span><span class="o">=</span> <span class="n">interpolation</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">keepratio</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">calc_dsize</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span><span class="n">dsize</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                calculates dsize to keep the image&#39;s ratio.</span>

<span class="sd">                :param shape: image shape</span>
<span class="sd">                :param dsize: dsize tuple with a None value</span>
<span class="sd">                :return: calculated dsize</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">dsize</span>
                <span class="n">sy</span><span class="p">,</span><span class="n">sx</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">dsize</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">sy</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sx</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">dsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sx</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sy</span><span class="p">)),</span><span class="n">y</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dsize</span> <span class="o">=</span> <span class="n">sx</span><span class="p">,</span><span class="n">sy</span>
                <span class="k">return</span> <span class="n">dsize</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">calc_dsize</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span><span class="n">dsize</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                calculates dsize without keeping the image&#39;s ratio.</span>

<span class="sd">                :param shape: image shape</span>
<span class="sd">                :param dsize: dsize tuple with a None value</span>
<span class="sd">                :return: calculated dsize</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">dsize</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dsize</span><span class="p">)</span>
                <span class="n">ndsize</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dsize</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">dsize</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndsize</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">dsize</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dsize</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">dsize</span>
        <span class="k">if</span> <span class="n">dsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">None</span> <span class="ow">in</span> <span class="n">dsize</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">resizefunc</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">loadfunc</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">calc_dsize</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">dsize</span><span class="p">),</span><span class="n">dst</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">resizefunc</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">loadfunc</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">dsize</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">resizefunc</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">loadfunc</span>

    <span class="k">if</span> <span class="n">mmode</span> <span class="ow">or</span> <span class="n">mpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c1"># if there is a mmode, or mpath is string</span>

        <span class="k">def</span> <span class="nf">mapfunc</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mpath</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span> <span class="c1"># save mmap in working directory</span>
                <span class="n">drive</span><span class="p">,</span><span class="n">dirname</span><span class="p">,(</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">getData</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">elif</span> <span class="n">mpath</span><span class="p">:</span><span class="c1"># save mmap in mpath</span>
                <span class="n">drive</span><span class="p">,</span><span class="n">dirname</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span><span class="n">changedir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">mpath</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># save mmap in image path</span>
                <span class="n">drive</span><span class="p">,</span><span class="n">dirname</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            # THIS CREATES A FOLDER TO MEMOIZE</span>
<span class="sd">            def dummy(path,flag=0,dsize=0,fx=0,fy=0,interpolation=0):</span>
<span class="sd">                return func(path)</span>
<span class="sd">            savepath = &quot;{}{}{}{}&quot;.format(drive,dirname,filename,ext)</span>
<span class="sd">            return memoize(savepath,mmap_mode=mmode)(dummy)(path,flag,dsize,fx,fy,interpolation)&quot;&quot;&quot;</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            # THIS CREATES TWO FILES BUT ONLY MEMOIZE ONE STATE OF IM ARGUMENTS</span>
<span class="sd">            savepath = &quot;{}{}{}{}.{}&quot;.format(drive,dirname,filename,ext,&quot;memoized&quot;)</span>
<span class="sd">            comps = (&quot;flag&quot;,&quot;dsize&quot;,&quot;fx&quot;,&quot;fy&quot;,&quot;interpolation&quot;)</span>
<span class="sd">            try: # load from map</span>
<span class="sd">                data = mapper(savepath, mmode=mmode)[0]</span>
<span class="sd">                bad = [i for i in comps if data[i] != locals()[i]]</span>
<span class="sd">                if bad:</span>
<span class="sd">                    raise IOError</span>
<span class="sd">                else:</span>
<span class="sd">                    return data[&quot;im&quot;]</span>
<span class="sd">            except IOError: # create object and map</span>
<span class="sd">                im = func(path)</span>
<span class="sd">                if im is None: # this is regardless of throw flag</span>
<span class="sd">                    raise Exception(&quot;Failed to load image to map&quot;)</span>
<span class="sd">                data = dict(im=im,flag=flag,dsize=dsize,fx=fx,fy=fy,interpolation=interpolation)</span>
<span class="sd">                return mapper(savepath,data,mmode)[0][&quot;im&quot;]&quot;&quot;&quot;</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            # THIS CREATES TWO HASHED FILES</span>
<span class="sd">            hashed = hash(&quot;{}{}{}{}{}{}&quot;.format(flag,RGB,dsize,fx,fy,interpolation))</span>
<span class="sd">            savepath = &quot;{}{}{}{}.{}&quot;.format(drive,dirname,filename,ext,hashed)</span>
<span class="sd">            try: # load from map</span>
<span class="sd">                im = mapper(savepath, mmode=mmode)[0]</span>
<span class="sd">                return im</span>
<span class="sd">            except IOError: # create object and map</span>
<span class="sd">                im = func(path)</span>
<span class="sd">                if im is None: # this is regardless of throw flag</span>
<span class="sd">                    raise Exception(&quot;Failed to load image to map&quot;)</span>
<span class="sd">                return mapper(savepath,im,mmode)[0]&quot;&quot;&quot;</span>
            <span class="c1"># THIS CREATES ONE HASHED FILE</span>
            <span class="n">hashed</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s2">&quot;{}{}{}{}{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span><span class="n">RGB</span><span class="p">,</span><span class="n">dsize</span><span class="p">,</span><span class="n">fx</span><span class="p">,</span><span class="n">fy</span><span class="p">,</span><span class="n">interpolation</span><span class="p">))</span>
            <span class="n">savepath</span> <span class="o">=</span> <span class="s2">&quot;{}{}{}{}.{}.npy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span><span class="n">dirname</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span><span class="p">,</span><span class="n">hashed</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span> <span class="c1"># load from map</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">mmode</span><span class="p">)</span> <span class="c1"># mapper(savepath,None,mmode,True)[0]#</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span> <span class="c1"># create object and map</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">im</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c1"># this is regardless of throw flag</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to load image to map&quot;</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">im</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">mmode</span><span class="p">)</span> <span class="c1"># mapper(savepath,im,mmode,True)[0]#</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">mapfunc</span> <span class="c1"># factory function</span>
    <span class="k">def</span> <span class="nf">loader</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">throw</span><span class="p">:</span>
                <span class="k">raise</span>
    <span class="k">return</span> <span class="n">loader</span> <span class="c1"># factory function</span></div>

<div class="viewcode-block" id="ImLoader"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImLoader">[docs]</a><span class="k">class</span> <span class="nc">ImLoader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to load image array from path, url,</span>
<span class="sd">    server, string or directly from numpy array (supports databases).</span>

<span class="sd">    :param flag: (default: 0) 0 to read as gray, 1 to read as BGR, -1 to</span>
<span class="sd">                read as BGRA, 2 to read as RGB, -2 to read as RGBA.</span>

<span class="sd">                It supports openCV flags:</span>
<span class="sd">                    * cv2.CV_LOAD_IMAGE_COLOR</span>
<span class="sd">                    * cv2.CV_LOAD_IMAGE_GRAYSCALE</span>
<span class="sd">                    * cv2.CV_LOAD_IMAGE_UNCHANGED</span>

<span class="sd">                +-------+-------------------------------+--------+</span>
<span class="sd">                | value | openCV flag                   | output |</span>
<span class="sd">                +=======+===============================+========+</span>
<span class="sd">                | (2)   | N/A                           | RGB    |</span>
<span class="sd">                +-------+-------------------------------+--------+</span>
<span class="sd">                | (1)   | cv2.CV_LOAD_IMAGE_COLOR       | BGR    |</span>
<span class="sd">                +-------+-------------------------------+--------+</span>
<span class="sd">                | (0)   | cv2.CV_LOAD_IMAGE_GRAYSCALE   | GRAY   |</span>
<span class="sd">                +-------+-------------------------------+--------+</span>
<span class="sd">                | (-1)  | cv2.CV_LOAD_IMAGE_UNCHANGED   | BGRA   |</span>
<span class="sd">                +-------+-------------------------------+--------+</span>
<span class="sd">                | (-2)  | N/A                           | RGBA   |</span>
<span class="sd">                +-------+-------------------------------+--------+</span>

<span class="sd">    :param dsize: (None) output image size; if it equals zero, it is computed as:</span>

<span class="sd">                \texttt{dsize = Size(round(fx*src.cols), round(fy*src.rows))}</span>

<span class="sd">    :param dst: (None) output image; it has the size dsize (when it is non-zero) or the</span>
<span class="sd">                size computed from src.size(), fx, and fy; the type of dst is uint8.</span>
<span class="sd">    :param fx: scale factor along the horizontal axis; when it equals 0, it is computed as</span>

<span class="sd">                \texttt{(double)dsize.width/src.cols}</span>

<span class="sd">    :param fy: scale factor along the vertical axis; when it equals 0, it is computed as</span>

<span class="sd">                \texttt{(double)dsize.height/src.rows}</span>

<span class="sd">    :param interpolation: interpolation method compliant with opencv:</span>

<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>
<span class="sd">                |flag | Operation       | Description                                           |</span>
<span class="sd">                +=====+=================+=======================================================+</span>
<span class="sd">                |(0)  | INTER_NEAREST   | nearest-neighbor interpolation                        |</span>
<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>
<span class="sd">                |(1)  | INTER_LINEAR    | bilinear interpolation (used by default)              |</span>
<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>
<span class="sd">                |(2)  | INTER_CUBIC     | bicubic interpolation over 4x4 pixel neighborhood     |</span>
<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>
<span class="sd">                |(3)  | INTER_AREA      | resampling using pixel area relation.                 |</span>
<span class="sd">                |     |                 | It may be a preferred method for image decimation,    |</span>
<span class="sd">                |     |                 | as it gives moire’-free results. But when the image   |</span>
<span class="sd">                |     |                 | is zoomed, it is similar to the INTER_NEAREST method. |</span>
<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>
<span class="sd">                |(4)  | INTER_LANCZOS4  | Lanczos interpolation over 8x8 pixel neighborhood     |</span>
<span class="sd">                +-----+-----------------+-------------------------------------------------------+</span>

<span class="sd">    :param mmode: (None) mmode to create mapped file. if mpath is specified loads image, converts</span>
<span class="sd">                to mapped file and then loads mapping file with mode {None, &#39;r+&#39;, &#39;r&#39;, &#39;w+&#39;, &#39;c&#39;}</span>
<span class="sd">                (it is slow for big images). If None, loads mapping file to memory (useful to keep</span>
<span class="sd">                image copy for session even if original image is deleted or modified).</span>
<span class="sd">    :param mpath: (None) path to create mapped file.</span>
<span class="sd">                None, do not create mapping file</span>
<span class="sd">                &quot;&quot;, uses path directory;</span>
<span class="sd">                &quot;*&quot;, uses working directory;</span>
<span class="sd">                else, uses specified directory.</span>

<span class="sd">    .. note:: If mmode is None and mpath is given it creates mmap file but loads from it to memory.</span>
<span class="sd">             It is useful to create physical copy of data to keep loading from (data can be reloaded</span>
<span class="sd">             even if original file is moved or deleted).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dsize</span><span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">interpolation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mmode</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">mpath</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">throw</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span> <span class="o">=</span> <span class="n">flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dsize</span> <span class="o">=</span> <span class="n">dsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dst</span> <span class="o">=</span> <span class="n">dst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fx</span> <span class="o">=</span> <span class="n">fx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fy</span> <span class="o">=</span> <span class="n">fy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mmode</span> <span class="o">=</span> <span class="n">mmode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpath</span> <span class="o">=</span> <span class="n">mpath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_throw</span> <span class="o">=</span> <span class="n">throw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span> <span class="o">=</span> <span class="n">loadFunc</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">dsize</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">,</span> <span class="n">mmode</span><span class="p">,</span> <span class="n">mpath</span><span class="p">,</span> <span class="n">throw</span><span class="p">)</span>

    <span class="c1">#i = loadFunc.__doc__.find(&quot;:param&quot;)</span>
    <span class="c1">#__init__.__doc__ = loadFunc.__doc__[:i] + __init__.__doc__ + loadFunc.__doc__[i:] # builds documentation dynamically</span>
    <span class="c1">#del i # job done, delete</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<div class="viewcode-block" id="ImLoader.getConfiguration"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImLoader.getConfiguration">[docs]</a>    <span class="k">def</span> <span class="nf">getConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Custom configuration from default configuration.</span>

<span class="sd">        :param kwargs: keys to customize default configuration.</span>
<span class="sd">                    If no key is provided default configuration is returned.</span>
<span class="sd">        :return: dictionary of configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;flag&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_flag</span><span class="p">,</span><span class="s2">&quot;dsize&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_dsize</span><span class="p">,</span><span class="s2">&quot;dst&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_dst</span><span class="p">,</span><span class="s2">&quot;fx&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_fx</span><span class="p">,</span><span class="s2">&quot;fy&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_fy</span><span class="p">,</span>
                <span class="s2">&quot;interpolation&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span><span class="p">,</span><span class="s2">&quot;mmode&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_mmode</span><span class="p">,</span><span class="s2">&quot;mpath&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpath</span><span class="p">,</span><span class="s2">&quot;throw&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_throw</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">temp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp</span></div>
<div class="viewcode-block" id="ImLoader.temp"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImLoader.temp">[docs]</a>    <span class="k">def</span> <span class="nf">temp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        loads from temporal loader created with customized and default parameters.</span>

<span class="sd">        :param kwargs: keys to customize default configuration.</span>
<span class="sd">        :return: loaded image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="s2">&quot;path&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="c1"># get path</span>
        <span class="k">return</span> <span class="n">loadFunc</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">getConfiguration</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))(</span><span class="n">path</span><span class="p">)</span> <span class="c1"># build a new loader and load path</span></div></div>

<div class="viewcode-block" id="PathLoader"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.PathLoader">[docs]</a><span class="k">class</span> <span class="nc">PathLoader</span><span class="p">(</span><span class="n">MutableSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to standardize loading images from list of paths and offer lazy evaluations.</span>

<span class="sd">    :param fns: list of paths</span>
<span class="sd">    :param loader: path loader (loadcv,loadsfrom, or function from loadFunc)</span>

<span class="sd">    Also see:: :func:`loadcv`, :func:`loadsfrom`, :func:`loadFunc`</span>

<span class="sd">    Example::</span>

<span class="sd">        fns = [&quot;/path to/image 1.ext&quot;,&quot;/path to/image 2.ext&quot;]</span>
<span class="sd">        imgs = pathLoader(fns)</span>
<span class="sd">        print imgs[0] # loads image in path 0</span>
<span class="sd">        print imgs[1] # loads image in path 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fns</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">loader</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="c1"># create factory functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fns</span> <span class="o">=</span> <span class="n">fns</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loader</span> <span class="o">=</span> <span class="n">loader</span> <span class="ow">or</span> <span class="n">loadFunc</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if called returns the list of paths</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fns</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fns</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fns</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fns</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fns</span><span class="p">)</span>

<div class="viewcode-block" id="PathLoader.insert"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.PathLoader.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fns</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">value</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="LoaderDict"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.LoaderDict">[docs]</a><span class="k">class</span> <span class="nc">LoaderDict</span><span class="p">(</span><span class="n">ResourceManager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to standardize loading objects and manage memory efficiently.</span>

<span class="sd">    :param loader: default loader for objects (e.g. load from file or create instance object)</span>
<span class="sd">    :param maxMemory: (None) max memory in specified unit to keep in check optimization (it does</span>
<span class="sd">                    not mean that memory never surpasses maxMemory).</span>
<span class="sd">    :param margin: (0.8) margin from maxMemory to trigger optimization.</span>
<span class="sd">                    It is in percentage of maxMemory ranging from 0 (0%) to maximum 1 (100%).</span>
<span class="sd">                    So optimal memory is inside range: maxMemory*margin &lt; Memory &lt; maxMemory</span>
<span class="sd">    :param unit: (MB) maxMemory unit, it can be GB (Gigabytes), MB (Megabytes), B (bytes)</span>
<span class="sd">    :param all: if True used memory is from all alive references,</span>
<span class="sd">                    if False used memory is only from keptAlive references.</span>
<span class="sd">    :param config: (Not Implemented)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loader</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">maxMemory</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">margin</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="nb">all</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">config</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LoaderDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">maxMemory</span><span class="p">,</span> <span class="n">margin</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="nb">all</span><span class="p">)</span>
        <span class="c1"># create factory functions</span>
        <span class="c1">#if config is None: from config import MANAGER as config</span>
        <span class="c1">#self._config = config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_loader</span> <span class="o">=</span> <span class="n">loader</span> <span class="ow">or</span> <span class="n">loadFunc</span><span class="p">()</span>

<div class="viewcode-block" id="LoaderDict.register"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.LoaderDict.register">[docs]</a>    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">func</span><span class="p">():</span> <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">func</span><span class="p">():</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_loader</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LoaderDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">func</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="try_loads"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.try_loads">[docs]</a><span class="k">def</span> <span class="nf">try_loads</span><span class="p">(</span><span class="n">fns</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">,</span> <span class="n">paths</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">addpath</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Try to load images from paths.</span>

<span class="sd">    :param fns: list of file names</span>
<span class="sd">    :param func: loader function</span>
<span class="sd">    :param paths: paths to try. By default it loads working dir and test path</span>
<span class="sd">    :param debug: True to show debug messages</span>
<span class="sd">    :param addpath: add path as second argument</span>
<span class="sd">    :return: image else None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">MANAGER</span><span class="p">[</span><span class="s2">&quot;TESTPATH&quot;</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">paths</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span><span class="nb">basestring</span><span class="p">):</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">paths</span><span class="p">]</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">default</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span> <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">fns</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">):</span> <span class="c1"># ensures path</span>
                    <span class="n">path</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">path</span> <span class="o">+=</span> <span class="n">fn</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="c1"># foreground</span>
            <span class="k">if</span> <span class="n">im</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot; Loaded...&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">addpath</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">im</span><span class="p">,</span><span class="n">path</span>
                <span class="k">return</span> <span class="n">im</span></div>

<div class="viewcode-block" id="hist_match"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.hist_match">[docs]</a><span class="k">def</span> <span class="nf">hist_match</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjust the pixel values of an image to match those of a template image.</span>

<span class="sd">    :param source: image to transform colors to template</span>
<span class="sd">    :param template: template image ()</span>
<span class="sd">    :param alpha:</span>
<span class="sd">    :return: transformed source</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># theory https://en.wikipedia.org/wiki/Histogram_matching</span>
    <span class="c1"># explanation http://dsp.stackexchange.com/a/16175 and</span>
    <span class="c1"># http://fourier.eng.hmc.edu/e161/lectures/contrast_transform/node3.html</span>
    <span class="c1"># based on implementation http://stackoverflow.com/a/33047048/5288758</span>
    <span class="c1"># see http://www.mathworks.com/help/images/ref/imhistmatch.html</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">matched</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hist_match</span><span class="p">(</span><span class="n">source</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">],</span> <span class="n">template</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">matched</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">oldshape</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="c1"># get the set of unique pixel values and their corresponding indices and</span>
        <span class="c1"># counts</span>
        <span class="n">s_values</span><span class="p">,</span> <span class="n">bin_idx</span><span class="p">,</span> <span class="n">s_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                                <span class="n">return_counts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">t_values</span><span class="p">,</span> <span class="n">t_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># take the cumsum of the counts and normalize by the number of pixels to</span>
        <span class="c1"># get the empirical cumulative distribution functions for the source and</span>
        <span class="c1"># template images (maps pixel value --&gt; quantile)</span>
        <span class="n">s_quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">s_counts</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">s_quantiles</span> <span class="o">/=</span> <span class="n">s_quantiles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">t_quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">t_counts</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">t_quantiles</span> <span class="o">/=</span> <span class="n">t_quantiles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># interpolate linearly to find the pixel values in the template image</span>
        <span class="c1"># that correspond most closely to the quantiles in the source image</span>
        <span class="n">interp_t_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">s_quantiles</span><span class="p">,</span> <span class="n">t_quantiles</span><span class="p">,</span> <span class="n">t_values</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">interp_t_values</span><span class="p">[</span><span class="n">bin_idx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">oldshape</span><span class="p">)</span> <span class="c1"># reconstruct image</span></div>

<span class="c1">############################# GETCOORS ############################################</span>
<span class="c1"># http://docs.opencv.org/master/db/d5b/tutorial_py_mouse_handling.html</span>
<span class="c1"># http://docs.opencv.org/modules/highgui/doc/qt_new_functions.html</span>

<div class="viewcode-block" id="ImCoors"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors">[docs]</a><span class="k">class</span> <span class="nc">ImCoors</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Image&#39;s coordinates class.</span>
<span class="sd">    Example::</span>

<span class="sd">        a = ImCoors(np.array([(116, 161), (295, 96), (122, 336), (291, 286)]))</span>
<span class="sd">        print a.__dict__</span>
<span class="sd">        print &quot;mean depend on min and max: &quot;, a.mean</span>
<span class="sd">        print a.__dict__</span>
<span class="sd">        print &quot;after mean max has been already been calculated: &quot;, a.max</span>
<span class="sd">        a.data = np.array([(116, 161), (295, 96)])</span>
<span class="sd">        print a.__dict__</span>
<span class="sd">        print &quot;mean and all its dependencies are processed again: &quot;, a.mean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initiliazes ImCoors.</span>

<span class="sd">        :param pts: list of points</span>
<span class="sd">        :param dtype: return data as dtype. Default is config.FLOAT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pts</span> <span class="o">=</span> <span class="n">pts</span> <span class="c1"># supports bigger numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deg</span> <span class="o">=</span> <span class="n">deg</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pts</span>
    <span class="nd">@pts.setter</span>
    <span class="k">def</span> <span class="nf">pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;__dict__&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pts</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@pts.deleter</span>
    <span class="k">def</span> <span class="nf">pts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot delete attribute&quot;</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span>
    <span class="nd">@dtype.setter</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;__dict__&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@dtype.deleter</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot delete attribute&quot;</span><span class="p">)</span>
    <span class="c1"># DATA METHODS</span>
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pts</span><span class="p">)</span>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.max"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maximum in each axis.</span>

<span class="sd">        :return: x_max, y_max</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#self.max_x, self.max_y = np.max(self.data,0)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pts</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.min"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Minimum in each axis.</span>

<span class="sd">        :return: x_min, y_min</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#self.min_x, self.min_y = np.min(self.data,0)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pts</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.rectbox"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.rectbox">[docs]</a>    <span class="k">def</span> <span class="nf">rectbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rectangular box enclosing points (origin and end point or rectangle).</span>

<span class="sd">        :return: (x0,y0),(x,y)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.boundingRect"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.boundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rectangular box dimensions enclosing points.</span>

<span class="sd">        example::</span>

<span class="sd">            P = np.ones((400,400))</span>
<span class="sd">            a = ImCoors(np.array([(116, 161), (295, 96), (122, 336), (291, 286)]))</span>
<span class="sd">            x0,y0,w,h = a.boundingRect</span>
<span class="sd">            P[y0:y0+h,x0:x0+w] = 0</span>

<span class="sd">        :return: x0,y0,w,h</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pts</span><span class="p">)</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.minAreaRect"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.minAreaRect">[docs]</a>    <span class="k">def</span> <span class="nf">minAreaRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">minAreaRect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pts</span><span class="p">)</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.rotatedBox"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.rotatedBox">[docs]</a>    <span class="k">def</span> <span class="nf">rotatedBox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotated rectangular box enclosing points.</span>

<span class="sd">        :return: 4 points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span> <span class="c1"># opencv 2</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">BoxPoints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minAreaRect</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="c1"># opencv 3</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">boxPoints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minAreaRect</span><span class="p">))</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.boxCenter"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.boxCenter">[docs]</a>    <span class="k">def</span> <span class="nf">boxCenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mean in each axis.</span>

<span class="sd">        :return: x_mean, y_mean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#self.mean_x = (self.max_x+self.min_x)/2</span>
        <span class="c1">#self.mean_y = (self.max_y+self.min_y)/2</span>
        <span class="n">xX</span><span class="p">,</span><span class="n">xY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span>
        <span class="n">nX</span><span class="p">,</span><span class="n">nY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">((</span><span class="n">xX</span> <span class="o">+</span> <span class="n">nX</span><span class="p">,</span> <span class="n">xY</span> <span class="o">+</span> <span class="n">nY</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.mean"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Center or mean.</span>
<span class="sd">        :return: x,y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># http://hyperphysics.phy-astr.gsu.edu/hbase/cm.html</span>
        <span class="c1"># https://www.grc.nasa.gov/www/K-12/airplane/cg.html</span>
        <span class="c1">#self.center_x, self.center_y = np.sum(self.data,axis=0)/len(self.data)</span>
        <span class="c1">#map(int,np.mean(self.data,0))</span>
        <span class="c1">#tuple(np.sum(self.data,axis=0)/len(self.data))</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pts</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">))</span></div>
    <span class="n">center</span> <span class="o">=</span> <span class="n">mean</span>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.area"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.area">[docs]</a>    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Area of points.</span>

<span class="sd">        :return: area number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">polygonArea</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pts</span><span class="p">)</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.rectangularArea"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.rectangularArea">[docs]</a>    <span class="k">def</span> <span class="nf">rectangularArea</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Area of rectangle enclosing points aligned with x,y axes.</span>

<span class="sd">        :return: area number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#method 1, it is not precise in rotation</span>
        <span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">),(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rectbox</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y0</span><span class="p">)))</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.rotatedRectangularArea"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.rotatedRectangularArea">[docs]</a>    <span class="k">def</span> <span class="nf">rotatedRectangularArea</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Area of Rotated rectangle enclosing points.</span>

<span class="sd">        :return: area number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">polygonArea</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotatedBox</span><span class="p">)</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.rectangularity"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.rectangularity">[docs]</a>    <span class="k">def</span> <span class="nf">rectangularity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ratio that represent a perfect square aligned with x,y axes.</span>

<span class="sd">        :return: ratio from 1 to 0, 1 representing a perfect rectangle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#method 1</span>
        <span class="c1">#cx,cy = self.center</span>
        <span class="c1">#bcx,bcy=self.boxCenter</span>
        <span class="c1">#return (cx)/bcx,(cy)/bcy # x_ratio, y_ratio</span>
        <span class="c1">#method 2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rectangularArea</span><span class="p">)</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.rotatedRectangularity"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.rotatedRectangularity">[docs]</a>    <span class="k">def</span> <span class="nf">rotatedRectangularity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ratio that represent a perfect rotated square fitting points.</span>

<span class="sd">        :return: ratio from 1 to 0, 1 representing a perfect rotated rectangle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># prevent unstable values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">area</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># needed to prevent false values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">area</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rotatedRectangularArea</span><span class="p">)</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.regularity"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.regularity">[docs]</a>    <span class="k">def</span> <span class="nf">regularity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ratio of forms with similar measurements and angles.</span>
<span class="sd">        e.g. squares and rectangles have rect angles so they are regular.</span>
<span class="sd">        For regularity object must give 1.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO this algorithm is still imperfect</span>
        <span class="n">pi</span> <span class="o">=</span> <span class="n">angle</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">deg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deg</span><span class="p">)</span> <span class="c1"># get pi value in radian or degrees</span>
        <span class="n">av</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexesAngles</span>
        <span class="k">return</span> <span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">av</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">av</span><span class="p">)</span> <span class="c1"># pi*number_agles/sum_angles</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.relativeVectors"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.relativeVectors">[docs]</a>    <span class="k">def</span> <span class="nf">relativeVectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Form vectors from points.</span>

<span class="sd">        :return: array of vectors [V0, ... , (V[n] = x[n+1]-x[n],y[n+1]-y[n])].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pts</span><span class="p">)</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pts</span><span class="p">,[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># adds last vector from last and first point.</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])],</span> <span class="mi">1</span><span class="p">)</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.vertexesAngles"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.vertexesAngles">[docs]</a>    <span class="k">def</span> <span class="nf">vertexesAngles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Relative angle of vectors formed by vertexes.</span>

<span class="sd">        i.e. angle between vectors &quot;v01&quot; formed by points &quot;p0-p1&quot; and &quot;v12&quot;</span>
<span class="sd">        formed by points &quot;p1-p2&quot; where &quot;p1&quot; is seen as a vertex (where vectors cross).</span>

<span class="sd">        :return: angles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relativeVectors</span> <span class="c1"># get all vectors from points.</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vs</span><span class="p">,[</span><span class="n">vs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># add last vector to first position</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">angle</span><span class="p">(</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">deg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deg</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">vs</span><span class="p">))],</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">)</span> <span class="c1"># caculate angles</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.pointsAngles"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.pointsAngles">[docs]</a>    <span class="k">def</span> <span class="nf">pointsAngles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Angle of vectors formed by points in Cartesian plane with respect to x axis.</span>

<span class="sd">        i.e. angle between vector &quot;v01&quot; (formed by points &quot;p0-p1&quot;) and vector unity in axis x.</span>

<span class="sd">        :return: angles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relativeVectors</span> <span class="c1"># get all vectors from points.</span>
        <span class="k">return</span> <span class="n">vectorsAngles</span><span class="p">(</span><span class="n">pts</span><span class="o">=</span><span class="n">vs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deg</span><span class="p">)</span></div>
    <span class="nd">@Cache</span>
<div class="viewcode-block" id="ImCoors.vectorsAngles"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.ImCoors.vectorsAngles">[docs]</a>    <span class="k">def</span> <span class="nf">vectorsAngles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Angle of vectors in Cartesian plane with respect to x axis.</span>

<span class="sd">        i.e. angle between vector &quot;v0&quot; (formed by point &quot;p0&quot; and the origin) and vector unity in axis x.</span>
<span class="sd">        :return: angles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">angle</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">i</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_deg</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pts</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">)</span> <span class="c1"># caculate angles with respect to x axis</span></div></div>

<div class="viewcode-block" id="drawcoorpoints"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.drawcoorpoints">[docs]</a><span class="k">def</span> <span class="nf">drawcoorpoints</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="o">=</span><span class="n">black</span><span class="p">,</span><span class="n">col_in</span><span class="o">=</span><span class="n">red</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Funtion to draw points.</span>

<span class="sd">    :param vis: image array.</span>
<span class="sd">    :param points: list of points.</span>
<span class="sd">    :param col_out: outer color of point.</span>
<span class="sd">    :param col_in: inner color of point.</span>
<span class="sd">    :param radius: radius of drawn points.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">INT</span><span class="p">)</span>
    <span class="n">radius_in</span> <span class="o">=</span> <span class="n">radius</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">col_out</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">radius_in</span><span class="p">,</span> <span class="n">col_in</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vis</span></div>

<div class="viewcode-block" id="myline"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.myline">[docs]</a><span class="k">def</span> <span class="nf">myline</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Funtion to draw points (experimental).</span>

<span class="sd">    :param img:</span>
<span class="sd">    :param pt1:</span>
<span class="sd">    :param pt2:</span>
<span class="sd">    :param color:</span>
<span class="sd">    :param thickness:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># y=m*x+b</span>
    <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT</span><span class="p">)</span>
    <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">FLOAT</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span>
    <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">])</span>
    <span class="n">xvect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
    <span class="n">yvect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xvect</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">x1</span><span class="o">*</span><span class="n">m</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yvect</span><span class="p">,</span><span class="n">xvect</span><span class="p">):</span>
        <span class="c1">#img.itemset(i,color)</span>
        <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">color</span></div>

<div class="viewcode-block" id="drawcooraxes"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.drawcooraxes">[docs]</a><span class="k">def</span> <span class="nf">drawcooraxes</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="o">=</span><span class="n">black</span><span class="p">,</span><span class="n">col_in</span><span class="o">=</span><span class="n">green</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to draw axes instead of points.</span>

<span class="sd">    :param vis: image array.</span>
<span class="sd">    :param points: list of points.</span>
<span class="sd">    :param col_out: outer color of point.</span>
<span class="sd">    :param col_in: inner color of point.</span>
<span class="sd">    :param radius: radius of drawn points.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">INT</span><span class="p">)</span>
    <span class="n">thickness</span> <span class="o">=</span> <span class="n">radius</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">h1</span><span class="p">,</span> <span class="n">w1</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># obtaining image dimensions</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="n">h1pt1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">h1pt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">w2pt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">w2pt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">h1</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">h1pt1</span><span class="p">,</span> <span class="n">h1pt2</span><span class="p">,</span> <span class="n">col_in</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">w2pt1</span><span class="p">,</span> <span class="n">w2pt2</span><span class="p">,</span> <span class="n">col_in</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">drawcoorpoints</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="p">,</span><span class="n">col_in</span><span class="p">,</span><span class="n">radius</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vis</span></div>

<div class="viewcode-block" id="drawcoorpolyline"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.drawcoorpolyline">[docs]</a><span class="k">def</span> <span class="nf">drawcoorpolyline</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="o">=</span><span class="n">black</span><span class="p">,</span><span class="n">col_in</span><span class="o">=</span><span class="n">red</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to draw interaction with points to obtain polygonal.</span>

<span class="sd">    :param vis: image array.</span>
<span class="sd">    :param points: list of points.</span>
<span class="sd">    :param col_out: outer color of point.</span>
<span class="sd">    :param col_in: inner color of point.</span>
<span class="sd">    :param radius: radius of drawn points.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">thickness</span> <span class="o">=</span> <span class="n">radius</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">INT</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">polylines</span><span class="p">(</span><span class="n">vis</span><span class="p">,[</span><span class="n">points</span><span class="p">],</span><span class="bp">False</span><span class="p">,</span> <span class="n">col_in</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        for i in range(len(points)-1):</span>
<span class="sd">            pt1 = (points[i][0], points[i][1])</span>
<span class="sd">            pt2 = (points[i+1][0], points[i+1][1])</span>
<span class="sd">            cv2.line(vis, pt1, pt2, col_in, thickness)&quot;&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">drawcoorpoints</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="p">,</span><span class="n">col_in</span><span class="p">,</span><span class="n">radius</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vis</span></div>

<div class="viewcode-block" id="drawcoorarea"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.drawcoorarea">[docs]</a><span class="k">def</span> <span class="nf">drawcoorarea</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="o">=</span><span class="n">black</span><span class="p">,</span><span class="n">col_in</span><span class="o">=</span><span class="n">red</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to draw interaction with points to obtain area.</span>

<span class="sd">    :param vis: image array.</span>
<span class="sd">    :param points: list of points.</span>
<span class="sd">    :param col_out: outer color of point.</span>
<span class="sd">    :param col_in: inner color of point.</span>
<span class="sd">    :param radius: radius of drawn points.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span><span class="n">mask</span><span class="p">,[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)],</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">overlay</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">col_in</span><span class="p">),</span><span class="n">col_in</span><span class="p">])[</span><span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span><span class="n">alpha</span><span class="o">=</span><span class="n">mask</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">drawcoorpoints</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="p">,</span><span class="n">col_in</span><span class="p">,</span><span class="n">radius</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">drawcoorpoints</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="p">,</span><span class="n">col_in</span><span class="p">,</span><span class="n">radius</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vis</span></div>

<div class="viewcode-block" id="drawcoorpolyArrow"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.drawcoorpolyArrow">[docs]</a><span class="k">def</span> <span class="nf">drawcoorpolyArrow</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="o">=</span><span class="n">black</span><span class="p">,</span><span class="n">col_in</span><span class="o">=</span><span class="n">red</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to draw interaction with vectors to obtain polygonal.</span>

<span class="sd">    :param vis: image array.</span>
<span class="sd">    :param points: list of points.</span>
<span class="sd">    :param col_out: outer color of point.</span>
<span class="sd">    :param col_in: inner color of point.</span>
<span class="sd">    :param radius: radius of drawn points.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">INT</span><span class="p">)</span>
    <span class="n">thickness</span> <span class="o">=</span> <span class="n">radius</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">pt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">pt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">arrowedLine</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">col_in</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">drawcoorpoints</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="p">,</span><span class="n">col_in</span><span class="p">,</span><span class="n">radius</span><span class="p">)</span> <span class="c1"># draw points</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">drawcoorpoints</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="p">,</span><span class="n">col_in</span><span class="p">,</span><span class="n">radius</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vis</span></div>

<div class="viewcode-block" id="drawcoorperspective"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.drawcoorperspective">[docs]</a><span class="k">def</span> <span class="nf">drawcoorperspective</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="o">=</span><span class="n">black</span><span class="p">,</span><span class="n">col_in</span><span class="o">=</span><span class="n">red</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to draw interaction with points to obtain perspective.</span>

<span class="sd">    :param vis: image array.</span>
<span class="sd">    :param points: list of points.</span>
<span class="sd">    :param col_out: outer color of point.</span>
<span class="sd">    :param col_in: inner color of point.</span>
<span class="sd">    :param radius: radius of drawn points.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">INT</span><span class="p">)</span>
    <span class="n">thickness</span> <span class="o">=</span> <span class="n">radius</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">j</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span>
                        <span class="c1">#print &quot;i=&quot;,i,&quot; j=&quot;,j</span>
                        <span class="n">pt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">pt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">cv2</span><span class="o">.</span><span class="n">arrowedLine</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">col_in</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">)):</span>
                    <span class="c1">#print &quot;i=&quot;,i,&quot; j=&quot;,j</span>
                    <span class="n">pt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">pt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">cv2</span><span class="o">.</span><span class="n">arrowedLine</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">col_in</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">drawcoorpoints</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="p">,</span><span class="n">col_in</span><span class="p">,</span><span class="n">radius</span><span class="p">)</span> <span class="c1"># draw points</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">drawcoorpoints</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">col_out</span><span class="p">,</span><span class="n">col_in</span><span class="p">,</span><span class="n">radius</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vis</span></div>

<div class="viewcode-block" id="limitaxispoints"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.limitaxispoints">[docs]</a><span class="k">def</span> <span class="nf">limitaxispoints</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">maxc</span><span class="p">,</span><span class="n">minc</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Limit a point in axis.</span>

<span class="sd">    :param c: list of points..</span>
<span class="sd">    :param maxc: maximum value of point.</span>
<span class="sd">    :param minc: minimum value of point.</span>
<span class="sd">    :return: return limited points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">limitaxis</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">maxc</span><span class="p">,</span><span class="n">minc</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="GetCoors"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.GetCoors">[docs]</a><span class="k">class</span> <span class="nc">GetCoors</span><span class="p">(</span><span class="n">Plotim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create window to select points from image.</span>

<span class="sd">    :param im: image to get points.</span>
<span class="sd">    :param win: window name.</span>
<span class="sd">    :param updatefunc: function to draw interaction with points.</span>
<span class="sd">            (e.g. limitaxispoints, drawcoorperspective, etc.).</span>
<span class="sd">    :param prox: proximity to identify point.</span>
<span class="sd">    :param radius: radius of drawn points.</span>
<span class="sd">    :param unique: If True no point can be repeated,</span>
<span class="sd">            else selected points can be repeated.</span>
<span class="sd">    :param col_out: outer color of point.</span>
<span class="sd">    :param col_in: inner color of point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">win</span> <span class="o">=</span> <span class="s2">&quot;get coordinates&quot;</span><span class="p">,</span> <span class="n">updatefunc</span><span class="o">=</span><span class="n">drawcoorpoints</span><span class="p">,</span>
                 <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">col_out</span><span class="o">=</span><span class="n">black</span><span class="p">,</span> <span class="n">col_in</span><span class="o">=</span><span class="n">red</span><span class="p">):</span>
        <span class="c1"># functions</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GetCoors</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span>
        <span class="c1"># assign functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatefunc</span> <span class="o">=</span> <span class="n">updatefunc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userupdatefunc</span> <span class="o">=</span> <span class="n">updatefunc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prox</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># proximity to keypoint</span>
        <span class="c1"># initialize user variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="n">unique</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_out</span> <span class="o">=</span> <span class="n">col_out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_in</span> <span class="o">=</span> <span class="n">col_in</span>
        <span class="c1"># initialize control variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_AREA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rcoors</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># rendered coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coorlen</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showstats</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapdata2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rH</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rW</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawcooraxes</span> <span class="o">=</span> <span class="n">drawcooraxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawcoorperspective</span> <span class="o">=</span> <span class="n">drawcoorperspective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawcoorpolyline</span> <span class="o">=</span> <span class="n">drawcoorpolyline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawcoorpoints</span> <span class="o">=</span> <span class="n">drawcoorpoints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controlText</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot; No. coordinates: {self.coorlen}. &quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdeval</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;points&quot;</span><span class="p">:</span><span class="s2">&quot;self.updatefunc = self.drawcoorpoints&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;polyline&quot;</span><span class="p">:</span><span class="s2">&quot;self.updatefunc = self.drawcoorpolyline&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;perspective&quot;</span><span class="p">:</span><span class="s2">&quot;self.updatefunc = self.drawcoorperspective&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;axes&quot;</span><span class="p">:</span><span class="s2">&quot;self.updatefunc = self.drawcooraxes&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;user&quot;</span><span class="p">:</span><span class="s2">&quot;self.updatefunc = self.userupdatefunc&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;end&quot;</span><span class="p">:[</span><span class="s2">&quot;self.updatecoors()&quot;</span><span class="p">,</span><span class="s2">&quot;self.mousefunc()&quot;</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;unique&quot;</span><span class="p">,</span><span class="s2">&quot;showstats&quot;</span><span class="p">,</span><span class="s2">&quot;user&quot;</span><span class="p">,</span><span class="s2">&quot;points&quot;</span><span class="p">,</span><span class="s2">&quot;polyline&quot;</span><span class="p">,</span><span class="s2">&quot;perspective&quot;</span><span class="p">,</span><span class="s2">&quot;axes&quot;</span><span class="p">])</span>
        <span class="c1">#self.coors # return coordinates</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coors</span>
    <span class="nd">@coors.setter</span>
    <span class="k">def</span> <span class="nf">coors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coors</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatecoors</span><span class="p">()</span>
    <span class="nd">@coors.deleter</span>
    <span class="k">def</span> <span class="nf">coors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatecoors</span><span class="p">()</span>

<div class="viewcode-block" id="GetCoors.drawstats"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.GetCoors.drawstats">[docs]</a>    <span class="k">def</span> <span class="nf">drawstats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">col_out</span><span class="o">=</span><span class="n">black</span><span class="p">,</span> <span class="n">col_in</span><span class="o">=</span><span class="n">green</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param self:</span>
<span class="sd">        :param points:</span>
<span class="sd">        :param col_out:</span>
<span class="sd">        :param col_in:</span>
<span class="sd">        :param radius:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rimg</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ImCoors</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">vis</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vis</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">drawcooraxes</span><span class="p">(</span><span class="n">vis</span><span class="p">,[</span><span class="n">p</span><span class="o">.</span><span class="n">boxCenter</span><span class="p">],</span><span class="n">col_out</span><span class="p">,</span><span class="n">col_in</span><span class="p">,</span><span class="n">radius</span><span class="p">)</span>
        <span class="n">drawcooraxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">,[</span><span class="n">p</span><span class="o">.</span><span class="n">boxCenter</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">prox</span><span class="p">)</span>
        <span class="n">drawcooraxes</span><span class="p">(</span><span class="n">vis</span><span class="p">,[</span><span class="n">p</span><span class="o">.</span><span class="n">mean</span><span class="p">],</span><span class="n">col_in</span><span class="p">,</span><span class="n">col_out</span><span class="p">,</span><span class="n">radius</span><span class="p">)</span>
        <span class="n">drawcooraxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">,[</span><span class="n">p</span><span class="o">.</span><span class="n">mean</span><span class="p">],</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">prox</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">ImCoors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapdata2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;center at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">boxCenter</span><span class="p">),</span><span class="s2">&quot;mean at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">mean</span><span class="p">)]</span></div>

<div class="viewcode-block" id="GetCoors.updatecoors"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.GetCoors.updatecoors">[docs]</a>    <span class="k">def</span> <span class="nf">updatecoors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param self:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coorlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updaterenderer</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coors</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rcoors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coors</span><span class="p">[:]</span>
            <span class="n">newc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coors</span><span class="p">[:]</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coors</span><span class="p">):</span>
                <span class="n">newc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real2render</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rcoors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">limitaxispoints</span><span class="p">(</span><span class="n">newc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="mi">10000</span><span class="p">,</span><span class="o">-</span><span class="mi">10000</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showstats</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drawstats</span><span class="p">(</span><span class="n">newc</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rimg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updatefunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rimg</span><span class="p">,</span><span class="n">newc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">col_out</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">col_in</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinateText</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;xy({self.x},{self.y})&quot;</span><span class="p">]]</span></div>

<div class="viewcode-block" id="GetCoors.mousefunc"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.GetCoors.mousefunc">[docs]</a>    <span class="k">def</span> <span class="nf">mousefunc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param self:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># control system</span>
        <span class="n">controlled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtincontrol</span><span class="p">()</span>
        <span class="n">drawed</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># get nearest coordinate to pointer</span>
        <span class="n">isnear</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coors</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># vals = anorm(np.int32(self.coors) - (self.x, self.y))  # relative to real coordinates</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">anorm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rcoors</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">))</span>  <span class="c1"># relative to rendered coordinates</span>
            <span class="n">near_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">vals</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prox</span><span class="p">,</span> <span class="n">vals</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vals</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">near_point</span><span class="p">):</span> <span class="c1"># if near point</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">near_point</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># get index</span>
                <span class="n">isnear</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coors</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coors</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coordinateText</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;point &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;x&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coordinateText</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;xy({self.x},{self.y})&quot;</span><span class="p">]]</span>

        <span class="c1"># coordinate system</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">controlled</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_RBUTTONDBLCLK</span><span class="p">:</span>  <span class="c1"># if middle button DELETE ALL COORDINATES</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coors</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">drawed</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">isnear</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_RBUTTONDOWN</span><span class="p">:</span>  <span class="c1"># if right button DELETE NEAREST COORDINATE</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coors</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># if more than one point delete first</span>
                <span class="n">drawed</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>  <span class="c1"># if left button ADD COORDINATE</span>
                <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">coors</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">coors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">drawed</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c1"># update renderer</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">controlled</span> <span class="ow">or</span> <span class="n">drawed</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updatecoors</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showstats</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapdata2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">]]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">isnear</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">coordinateText</span> <span class="o">=</span> <span class="p">[[</span><span class="n">data</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">builtinplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)])</span></div></div>

<div class="viewcode-block" id="getcoors"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.getcoors">[docs]</a><span class="k">def</span> <span class="nf">getcoors</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">win</span> <span class="o">=</span><span class="s2">&quot;get coordinates&quot;</span><span class="p">,</span> <span class="n">updatefunc</span><span class="o">=</span><span class="n">drawcoorpoints</span><span class="p">,</span> <span class="n">coors</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">prox</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">col_out</span><span class="o">=</span><span class="n">black</span><span class="p">,</span> <span class="n">col_in</span><span class="o">=</span><span class="n">red</span><span class="p">):</span>
    <span class="bp">self</span> <span class="o">=</span> <span class="n">GetCoors</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">updatefunc</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">unique</span><span class="p">,</span> <span class="n">col_out</span><span class="o">=</span><span class="n">col_out</span><span class="p">,</span> <span class="n">col_in</span><span class="o">=</span><span class="n">col_in</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prox</span> <span class="o">=</span> <span class="n">prox</span>
    <span class="k">if</span> <span class="n">coors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coors</span> <span class="o">=</span> <span class="n">standarizePoints</span><span class="p">(</span><span class="n">coors</span><span class="p">,</span><span class="n">aslist</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">clean</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">coors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coors</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">coors</span></div>

<div class="viewcode-block" id="separe"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.separe">[docs]</a><span class="k">def</span> <span class="nf">separe</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Separate values from separator or threshold.</span>

<span class="sd">    :param values: list of values</span>
<span class="sd">    :param sep: peparator value</span>
<span class="sd">    :param axis: axis in each value</span>
<span class="sd">    :return: lists of greater values, list of lesser values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">greater</span><span class="p">,</span><span class="n">lesser</span> <span class="o">=</span> <span class="p">[],[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">&gt;</span><span class="n">sep</span><span class="p">:</span>
            <span class="n">greater</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lesser</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">greater</span><span class="p">,</span><span class="n">lesser</span></div>


<div class="viewcode-block" id="getrectcoors"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.getrectcoors">[docs]</a><span class="k">def</span> <span class="nf">getrectcoors</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     Get ordered points.</span>

<span class="sd">    :param data: list of points</span>
<span class="sd">    :return: [Top_left,Top_right,Bottom_left,Bottom_right]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#[Top_left,Top_right,Bottom_left,Bottom_right]</span>
    <span class="c1">#img, win = &quot;get pixel coordinates&quot;, updatefunc = drawpoint</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># points</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># img, win</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">getcoors</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">ImCoors</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">min_x</span><span class="p">,</span><span class="n">min_y</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">min</span>
    <span class="n">max_x</span><span class="p">,</span><span class="n">max_y</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">max</span>
    <span class="n">Top_left</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_x</span><span class="p">,</span><span class="n">min_y</span><span class="p">)</span>
    <span class="n">Top_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_x</span><span class="p">,</span><span class="n">min_y</span><span class="p">)</span>
    <span class="n">Bottom_left</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_x</span><span class="p">,</span><span class="n">max_y</span><span class="p">)</span>
    <span class="n">Bottom_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_x</span><span class="p">,</span><span class="n">max_y</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Top_left</span><span class="p">,</span><span class="n">Top_right</span><span class="p">,</span><span class="n">Bottom_left</span><span class="p">,</span><span class="n">Bottom_right</span><span class="p">]</span></div>

<div class="viewcode-block" id="quadrants"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.quadrants">[docs]</a><span class="k">def</span> <span class="nf">quadrants</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Separate points respect to center of gravity point.</span>

<span class="sd">    :param points: list of points</span>
<span class="sd">    :return: [[Top_left],[Top_right],[Bottom_left],[Bottom_right]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># group points on 4 quadrants</span>
    <span class="c1"># [Top_left,Top_right,Bottom_left,Bottom_right]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">ImCoors</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>  <span class="c1"># points data x,y -&gt; (width,height)</span>
    <span class="n">mean_x</span><span class="p">,</span> <span class="n">mean_y</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">mean</span>
    <span class="n">Bottom</span><span class="p">,</span><span class="n">Top</span> <span class="o">=</span> <span class="n">separe</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">mean_y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Top_right</span><span class="p">,</span><span class="n">Top_left</span> <span class="o">=</span> <span class="n">separe</span><span class="p">(</span><span class="n">Top</span><span class="p">,</span><span class="n">mean_x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Bottom_right</span><span class="p">,</span><span class="n">Bottom_left</span> <span class="o">=</span> <span class="n">separe</span><span class="p">(</span><span class="n">Bottom</span><span class="p">,</span><span class="n">mean_x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Top_left</span><span class="p">,</span><span class="n">Top_right</span><span class="p">,</span><span class="n">Bottom_left</span><span class="p">,</span><span class="n">Bottom_right</span><span class="p">]</span></div>

<div class="viewcode-block" id="getgeometrycoors"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.getgeometrycoors">[docs]</a><span class="k">def</span> <span class="nf">getgeometrycoors</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get filled object coordinates. (function in progress)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#[Top_left,Top_right,Bottom_left,Bottom_right]</span>
    <span class="c1">#img, win = &quot;get pixel coordinates&quot;, updatefunc = drawpoint</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># points</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># img, win</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">getcoors</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">points</span></div>


<div class="viewcode-block" id="random_color"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.random_color">[docs]</a><span class="k">def</span> <span class="nf">random_color</span><span class="p">(</span><span class="n">channels</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Random color.</span>

<span class="sd">    :param channels: number of channels</span>
<span class="sd">    :param min: min color in any channel</span>
<span class="sd">    :param max: max color in any channel</span>
<span class="sd">    :return: random color</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">channels</span><span class="p">)]</span></div>


<div class="viewcode-block" id="Image"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.Image">[docs]</a><span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Structure to load and save images</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loader</span> <span class="o">=</span> <span class="n">loadFunc</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">dsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">throw</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span> <span class="c1"># it is the inverted of dsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="o">=</span><span class="n">ext</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">=</span><span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_RGB</span><span class="o">=</span><span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_RGBA</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gray</span><span class="o">=</span><span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BGRA</span><span class="o">=</span><span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BGR</span><span class="o">=</span><span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overwrite</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_saved</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_loaded</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_loaded</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span>
    <span class="nd">@shape.setter</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># invert, for value is shape and we need dsize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loader</span> <span class="o">=</span> <span class="n">loadFunc</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">dsize</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">throw</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@shape.deleter</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext</span>
    <span class="nd">@ext.setter</span>
    <span class="k">def</span> <span class="nf">ext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span> <span class="c1"># ensures path</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ext</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@ext.deleter</span>
    <span class="k">def</span> <span class="nf">ext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
    <span class="nd">@path.setter</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">):</span> <span class="c1"># ensures path</span>
                <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@path.deleter</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">BGRA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BGRA</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BGRA</span>
    <span class="nd">@BGRA.setter</span>
    <span class="k">def</span> <span class="nf">BGRA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BGRA</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@BGRA.deleter</span>
    <span class="k">def</span> <span class="nf">BGRA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BGRA</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">BGR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BGR</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BGR</span>
    <span class="nd">@BGR.setter</span>
    <span class="k">def</span> <span class="nf">BGR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BGR</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@BGR.deleter</span>
    <span class="k">def</span> <span class="nf">BGR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BGR</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">RGB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RGB</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_RGB</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BGR</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RGB</span>
    <span class="nd">@RGB.setter</span>
    <span class="k">def</span> <span class="nf">RGB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_RGB</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@RGB.deleter</span>
    <span class="k">def</span> <span class="nf">RGB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_RGB</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">RGBA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RGBA</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_RGBA</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BGRA</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGRA2RGBA</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RGBA</span>
    <span class="nd">@RGBA.setter</span>
    <span class="k">def</span> <span class="nf">RGBA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_RGBA</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@RGBA.deleter</span>
    <span class="k">def</span> <span class="nf">RGBA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_RGBA</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gray</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BGR</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gray</span>
    <span class="nd">@gray.setter</span>
    <span class="k">def</span> <span class="nf">gray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gray</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@gray.deleter</span>
    <span class="k">def</span> <span class="nf">gray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gray</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="Image.save"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.Image.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save restored image in path.</span>

<span class="sd">        :param name: filename, string to format or path to save image.</span>
<span class="sd">                if path is not a string it would be replaced with the string</span>
<span class="sd">                &quot;{path}restored_{name}{ext}&quot; to format with the formatting</span>
<span class="sd">                &quot;{path}&quot;, &quot;{name}&quot; and &quot;{ext}&quot; from the baseImage variable.</span>
<span class="sd">        :param image: (self.BGRA)</span>
<span class="sd">        :param overwrite: If True and the destine filename for saving already</span>
<span class="sd">            exists then it is replaced, else a new filename is generated</span>
<span class="sd">            with an index &quot;{filename}_{index}.{extension}&quot;</span>
<span class="sd">        :return: saved path, status (True for success and False for fail)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;name parameter needed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BGRA</span>

        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">overwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overwrite</span>

        <span class="n">bbase</span><span class="p">,</span> <span class="n">bpath</span><span class="p">,</span> <span class="n">bname</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">bext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span>
        <span class="c1"># format path if user has specified so</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">bbase</span><span class="p">,</span> <span class="n">bpath</span><span class="p">)),</span>
                                   <span class="n">name</span><span class="o">=</span><span class="n">bname</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="n">bext</span><span class="p">))</span>
        <span class="c1"># complete any data lacking in path</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,(</span><span class="n">bbase</span><span class="p">,</span> <span class="n">bpath</span><span class="p">,</span> <span class="n">bname</span><span class="p">,</span> <span class="n">bext</span><span class="p">))):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
        <span class="c1"># joint parts to get string</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">mkPath</span><span class="p">(</span><span class="n">getPath</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">increment_if_exits</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">image</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Saved: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_saved</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_saved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fn</span><span class="p">,</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} could not be saved&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">fn</span><span class="p">,</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="Image.load"><a class="viewcode-back" href="../../../RRtoolbox.lib.html#RRtoolbox.lib.image.Image.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">try_loads</span><span class="p">([</span><span class="n">name</span><span class="p">,</span><span class="n">name</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">],</span> <span class="n">paths</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loader</span><span class="p">,</span> <span class="n">addpath</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Image not Loaded&quot;</span><span class="p">)</span>

        <span class="n">img</span><span class="p">,</span> <span class="n">last_loaded</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_loaded</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_loaded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_loaded</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;loaded: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">last_loaded</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_loaded</span> <span class="o">=</span> <span class="n">last_loaded</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_RGB</span><span class="o">=</span><span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_RGBA</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gray</span><span class="o">=</span><span class="bp">None</span>

        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BGR</span> <span class="o">=</span> <span class="n">img</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BGRA</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2BGRA</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BGRA</span> <span class="o">=</span> <span class="n">img</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BGR</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGRA2BGR</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, David Toro.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
    </div>

    

    
  </body>
</html>